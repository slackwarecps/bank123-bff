openapi: 3.0.3
info:
  title: Bank123 API
  description: API de Extrato e Saldo para o App Bank123 (Auth via Firebase)
  contact:
    name: Fabão (Tech Lead)
  version: 1.0.0
servers:
  - url: http://localhost:8080
    description: Servidor Local

tags:
  - name: Extrato
    description: Operações de consulta financeira
  - name: Usuario
    description: Operações de dados cadastrais do usuário

# Definição global dos componentes para reutilizar
components:
  schemas:
    SaldoResponse:
      type: object
      properties:
        numeroConta:
          type: integer
          example: 123456
        saldo:
          type: number
          format: double
          example: 1000.00
    Transacao:
      type: object
      properties:
        idTransacao:
          type: integer
          example: 1
        dataTransacao:
          type: string
          format: date-time
          example: "2025-12-12T22:54:40.031526"
        valorTransacao:
          type: number
          format: double
          example: 60.00
        operacao:
          type: string
          enum: [ENTRADA, SAIDA]
          example: SAIDA
        destino:
          type: string
          example: "Fabio Pereira"
        origem:
          type: string
          example: "Tatiana Favoretti"

  # Parâmetros de Cabeçalho Reutilizáveis
  parameters:
    HeaderAuthorization:
      name: Authorization
      in: header
      description: Token JWT do Firebase (Padrão Bearer)
      required: true
      schema:
        type: string
        example: "Bearer eyJhbGciOiJSUzI1NiIs..."
    HeaderAccountId:
      name: x-account-id
      in: header
      description: Identificador da Conta (Contexto do Usuário)
      required: true
      schema:
        type: integer
        example: 123456
    HeaderCorrelationId:
      name: x-correlationId
      in: header
      description: ID único para rastreamento de requisição (Tracing)
      required: true
      schema:
        type: string
        format: uuid
        example: "a1b2c3d4-e5f6-7890-a1b2-c3d4e5f67890"

paths:
  /bff-bank123/extrato/v1/saldo:
    get:
      tags:
        - Extrato
      summary: Consultar Saldo
      description: Retorna o saldo da conta informada no header.
      operationId: getSaldo
      parameters:
        - $ref: '#/components/parameters/HeaderAuthorization'
        - $ref: '#/components/parameters/HeaderAccountId'
        - $ref: '#/components/parameters/HeaderCorrelationId'
      responses:
        '200':
          description: Saldo retornado com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SaldoResponse'
        '401':
          description: Não autorizado (Token inválido)
        '403':
          description: Acesso negado (Conta não pertence ao token)

  /bff-bank123/extrato/v1/listagem:
    get:
      tags:
        - Extrato
      summary: Listar Extrato
      description: Retorna as movimentações baseadas no contexto do header.
      operationId: getExtrato
      parameters:
        - $ref: '#/components/parameters/HeaderAuthorization'
        - $ref: '#/components/parameters/HeaderAccountId'
        - $ref: '#/components/parameters/HeaderCorrelationId'
      responses:
        '200':
          description: Lista de transações retornada com sucesso
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Transacao'
        '401':
          description: Não autorizado

  /bff-bank123/usuario/v1/perfil:
    get:
      tags:
        - Usuario
      summary: Obter dados cadastrais
      description: Retorna nome e endereço baseados na conta do header.
      parameters:
        - $ref: '#/components/parameters/HeaderAuthorization'
        - $ref: '#/components/parameters/HeaderAccountId'
      responses:
        '200':
          description: Dados retornados com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  nomeCompleto:
                    type: string
                    example: "Fabio Pereira"
                  endereco:
                    type: string
                    example: "Rua das Flores, 123"